{% extends 'layout.html'%}
{% block content%}


<!--seccion INFORMACION INICIAL-->
<div class="col-md-12">

    <form id="checklist" method="POST" action="" class="">

        {{ form.hidden_tag() }}
        {% if true %}
        <div class="row p-3 mb-5 bg-body rounded content-section border border-5 border-primary-subtle">
            <legend class="text-center"><strong class="display-6 colorh2">Purchase Order Processing Checklist -
                    Chile</strong></legend>
            <strong class="dislpay-6">Welcome {{current_user.name}}</strong>

            <div class="row">
                <div class="col-md-3">
                    {{form.sales_force_id.label(class="form-control-label mt-3 pt-0 mb-0 ",
                    for="validationCustom01")}}
                    {{form.sales_force_id(class="form-control form-control-md validated")}}
                    {% if form.sales_force_id.errors and form.sales_force_id.data%}
                    {% for error in form.sales_force_id.errors %}
                    <p id="error" class="text-danger"> {{error}}</p>
                    {% endfor %}
                    {% endif %}

                </div>
                <div class="col-md-3">
                    {{form.purchase_order.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form.purchase_order(class="form-control form-control-md validated " , id='validationcustome01')}}
                    {% if form.purchase_order.errors and form.purchase_order.data%}
                    {% for error in form.purchase_order.errors %}
                    <p id="error" class="text-danger"> {{error}}</p>
                    {% endfor %}
                    {% endif %}

                </div>
                <div class="col-md-3">
                    {{form.quote_direct.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form.quote_direct(class="form-control form-control-md validated " , id='validationcustome01')}}
                    {% if form.quote_direct.errors and form.quote_direct.data%}
                    {% for error in form.quote_direct.errors %}
                    <p id="error" class="text-danger"> {{error}}</p>
                    {% endfor %}
            
                    {% endif %}
                </div>
                <div class="col-md-3">
                    {{form.pre_sales_name.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form.pre_sales_name(class="custom-select", id="inputGroupSelect04",
                    for="validationCustom01")}}
                    {% if form.pre_sales_name.errors and form.pre_sales_name.data%}
                    {% for error in form.pre_sales_name.errors %}
                    <p id="error" class="text-danger"> {{error}}</p>
                    {% endfor %}
                    {% endif %}
                </div>

            </div>

            <div class="row"> </div>

        </div>


        <div class="col-md-12 ">
            <div class="row p-3 mb-5 bg-body rounded content-section border border-info">


                <legend class="text-center"><strong>CUSTOMER INFORMATION </strong></legend>
                <hr>
                <div>
                    <div class="col-md-12 row">
                        <div class="col-md-4">
                        </div>
                        <div class="col-md-4 custome-select">
                            <div class="wrapper">
                                <div class="select-btn ">
                                    <span>Select Customer</span>
                                    <i class="uil uil-angle-down"></i>
                                </div>
                                <div class="content">
                                    <div class="search">
                                        <i class="uil uil-search"></i>
                                        <input spellcheck="false" type="text" placeholder="Search">
                                    </div>
                                    <ul class="options"></ul>
                                </div>
                            </div>


                            <table class="table mt-2 border-end" id="customer_table">
                                <tbody>
                                    <tr class="table-primary">
                                        <th scope="col table-info">Customer Name</th>
                                        <th scope="col table-info">Customer RUT </th>
                                    </tr>
                                    <tr>
                                        <th id="customer_name_row"></td>
                                        <th id="customer_rut_row"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                          <div class="col-md-4">
                        </div>
                        <div class="col-md-12 row">
                            <legend class="text-center"><strong><i class="fs-6">Contact Customer
                                        Information</i></strong>
                            </legend>



                            <div class="col-md-3 ">
                                {{form.customer_address.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.customer_address(class="form-control form-control-md mb-4 ml-2 validated " ,
                                id='validationcustome01')}}
                                {% if form.customer_address.errors and form.customer_address.data %}
                                {% for error in form.customer_address.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                    
                                {% endif %}

                            </div>

                            <div class="col-md-3 ">
                                {{form.customer_contact_name.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.customer_contact_name(class="form-control form-control-md mb-4 ml-2 validated " ,
                                id='validationcustome01')}}
                                {% if form.customer_contact_name.errors and form.customer_contact_name.data %}
                                {% for error in form.customer_contact_name.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}

                            </div>

                            <div class="col-md-3 ">
                                {{form.customer_contact_phone.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.customer_contact_phone(class="form-control form-control-md mb-4 ml-2 validated "
                                ,
                                id='validationcustome01')}}
                                {% if form.customer_contact_phone.errors and form.customer_contact_phone.data %}
                                {% for error in form.customer_contact_phone.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}

                            </div>

                            <div class="col-md-3 ">
                                {{form.customer_contact_email.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.customer_contact_email(class="form-control form-control-md mb-4 ml-2 validated "
                                ,
                                id='validationcustome01')}}
                                {% if form.customer_contact_email.errors and form.customer_contact_email.data %}
                                {% for error in form.customer_contact_email.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}

                            </div>
                            <legend class="text-center"><strong><i class="fs-6">Dispatch Customer
                                        Information</i></strong>
                            </legend>

                            <div class="col-md-3 ">
                                {{form.dispatch_address.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.dispatch_address(class="form-control form-control-md mb-4 ml-2 validated " ,
                                id='validationcustome01')}}
                                {% if form.dispatch_address.errors and form.dispatch_address.data %}
                                {% for error in form.dispatch_address.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}

                            </div>

                            <div class="col-md-3 ">

                                {{form.dispatch_receiver_name.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.dispatch_receiver_name(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form.dispatch_receiver_name.errors and form.dispatch_receiver_name.data%}
                                {% for error in form.dispatch_receiver_name.errors %}
                                <p class="text-danger is-invalid"> {{error}}</p>
                                {% endfor %}
                                {% endif %}


                            </div>
                            <div class="col-md-3 ">
                                {{form.dispatch_receiver_phone.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.dispatch_receiver_phone(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form.dispatch_receiver_phone.errors and form.dispatch_receiver_phone.data%}
                                {% for error in form.dispatch_receiver_phone.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}

                            </div>
                            <div class="col-md-3 ">

                                {{form.dispatch_receiver_email.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.dispatch_receiver_email(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form.dispatch_receiver_email.errors and form.dispatch_receiver_email.data %}
                                {% for error in form.dispatch_receiver_email.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}

                            </div>

                        </div>

                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        <!--SECCION CISCO-->

        <input type="number" id="cisco_quantity" name="cisco_quantity" value="{{forms_cisco|length}}" hidden>
        <section id="cisco_vendor" , name="seccion-prueba" , class="col-md-12">
            {% if forms_cisco %}
            <div class="row shadow-sm  mb-5 bg-body rounded content-section border border-info " id="form_cisco">
                <legend class="text-center"><strong>CISCO INFORMATION </strong></legend><br>
                    <div id="all_cisco_forms" class="row">
                        {% for form_cisco in forms_cisco%}
                            <div class="col-md-12 row" id="form_section_cisco_{{form_cisco.index.data}}">
                                <hr>

                                <div id="cisco_deal_id" , class="col-md-2 row">
                                    <div class="">
                                        <div class="form-group  border-1 ">
                                            {{form_cisco.cisco_deal_id.label(class="form-control-label",
                                            for="validationCustom01")}}
                                            {{form_cisco.cisco_deal_id(class="form-control form-control-md validated " ,
                                            id='validationcustome01')}}
                                            {% if form_cisco.cisco_deal_id.errors and form_cisco.cisco_deal_id.data %}
                                            {% for error in form_cisco.cisco_deal_id.errors %}
                                            <p id="error" class="text-danger"> {{error}}</p>
                                            {% endfor %}
                                            {% endif %}
                                        
                                            <button id="btn_search_deal_id" , type="button", class="btn btn-md btn-outline-success mt-3">
                                                Search</button>


                                        </div>
                                    </div>


                                </div>

                                <div id="cisco_account_manager_name" , class="col-md-auto row">
                                    <div class="">
                                        <div class="form-group  needs-validation">
                                            {{form_cisco.cisco_account_manager_name.label(class="form-control-label",
                                            for="validationCustom01")}}
                                            {{form_cisco.cisco_account_manager_name(class="form-control form-control-md
                                            validated " ,
                                            id='validationcustome01')}}
                                            {% if form_cisco.cisco_account_manager_name.errors and form_cisco.cisco_account_manager_name.data %}
                                            {% for error in form_cisco.cisco_account_manager_name.errors %}
                                            <p id="error" class="text-danger"> {{error}}</p>
                                            {% endfor %}
                                            {% endif %}
                                        
                                        </div>
                                    </div>

                                </div>
                                <div id="cisco_account_manager_phone" , class="col-md-auto row ">
                                    <div class="">
                                        <div class="form-group  needs-validation">
                                            {{form_cisco.cisco_account_manager_phone.label(class="form-control-label",
                                            for="validationCustom01")}}
                                            {{form_cisco.cisco_account_manager_phone(class="form-control form-control-md
                                            validated " ,
                                            id='validationcustome01')}}
                                            {% if form_cisco.cisco_account_manager_phone.errors and form_cisco.cisco_account_manager_phone.data %}
                                            {% for error in form_cisco.cisco_account_manager_phone.errors %}
                                            <p id="error" class="text-danger"> {{error}}</p>
                                            {% endfor %}
                                            {% endif %}
                                    
                                        </div>
                                    </div>

                                </div>

                                <div id="cisco_account_manager_email" , class="col-md-auto row">
                                    <div class="">
                                        <div class="form-group  needs-validation">
                                            {{form_cisco.cisco_account_manager_email.label(class="form-control-label",
                                            for="validationCustom01")}}
                                            {{form_cisco.cisco_account_manager_email(class="form-control form-control-md
                                            validated " ,
                                            id='validationcustome01')}}
                                            {% if form_cisco.cisco_account_manager_email.errors and form_cisco.cisco_account_manager_email.data %}
                                            {% for error in form_cisco.cisco_account_manager_email.errors %}
                                            <p id="error" class="text-danger"> {{error}}</p>
                                            {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>

                                </div>
                                <div id="cisco_smart_account" , class="col-md-auto row ">
                                    <div class="">
                                        <div class="form-group  needs-validation">
                                            {{form_cisco.cisco_smart_account.label(class="form-control-label",
                                            for="validationCustom01")}}
                                            {{form_cisco.cisco_smart_account(class="form-control form-control-md validated " ,
                                            id='validationcustome01')}}
                                            {% if form_cisco.cisco_smart_account.errors and form_cisco.cisco_smart_account.data %}
                                            {% for error in form_cisco.cisco_smart_account.errors %}
                                            <p id="error" class="text-danger"> {{error}}</p>
                                            {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>

                                </div>

                                <div id="cisco_virtual_account" , class="col-md-auto row ">
                                    <div class="">
                                        <div class="form-group  needs-validation">
                                            {{form_cisco.cisco_virtual_account.label(class="form-control-label",
                                            for="validationCustom01")}}
                                            {{form_cisco.cisco_virtual_account(class="form-control form-control-md validated " ,
                                            id='validationcustome01')}}
                                            {% if form_cisco.cisco_virtual_account.errors and form_cisco.cisco_virtual_account.data %}
                                            {% for error in form_cisco.cisco_virtual_account.errors %}
                                            <p id="error" class="text-danger"> {{error}}</p>
                                            {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>



                                <div id="delete_cisco" , class=" col-md-1 row ">
                                    <div class="">
                                        <div class="form-group  needs-validation">
                                            <br>
                                            <button id="delete_form" type="button" name="delete_cisco"
                                                class="btn btn-outline-danger" onclick="deleteForm('#form_section_cisco_{{form_cisco.index.data}}')">
                                                X</button>


                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                <div class="row">
                    <button id="btnciscovendor" type="button" class="btn btn-md btn-outline-primary  col-md-3 mt-4"> Add Cisco
                        Vendor </button>
                </div>
            </div>
            {% endif %}

            <input id="cisco_has_data" name="cisco_has_data" type="hidden">
            <input id="software_has_data" name="software_has_data" type="hidden">
            <input id="vendor_has_data" name="vendor_has_data" type="hidden">
            {{ customer.customer_name(hidden=True, id="customer_name") }}
            {{ customer.customer_rut(hidden=True, id="customer_rut") }}
            {{ form.customer_id(hidden=True, id="customer_id") }}
    
    <!--SECCION VENDOR-->
<input type="number" id="vendor_quantity" name="vendor_quantity" value="{{forms_vendor|length}}" hidden>
<section id="vendor" , name="seccion-prueba" , class="col-md-12">
    {% if forms_vendor %}
    <div class="row shadow-sm p-3 mb-5 bg-body rounded content-section border border-info" id="form_vendor">
        
        <legend class="text-center"><strong>VENDOR INFORMATION </strong></legend><br>

        <div id="all_vendor_forms" class="row">
            {% for form_vendor in forms_vendor%}
                <div class="col-md-12 row" id="form_section_vendor_{{form_vendor.index.data}}">
                    <hr>
        
                    <div id="vendor_deal_id" , class="col-md-2 row">
                        <div class="">
                            <div class="form-group ">
                                {{form_vendor.vendor_deal_id.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_vendor.vendor_deal_id(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form_vendor.vendor_deal_id.errors and form_vendor.vendor_deal_id.data %}
                                {% for error in form_vendor.vendor_deal_id.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>

                    </div>
                    
                    <div id="vendor_name" , class="col-md-2 row">
                        <div class="">
                            <div class="form-group " >
                                {{form_vendor.vendor_name.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_vendor.vendor_name(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form_vendor.vendor_name.errors and form_vendor.vendor_name.data %}
                                {% for error in form_vendor.vendor_name.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>

                    </div>


                    <div id="vendor_account_manager_name" , class="col-md-2 row ">
                        <div class=" ">
                            <div class="form-group " >
                                {{form_vendor.vendor_account_manager_name.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_vendor.vendor_account_manager_name(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form_vendor.vendor_account_manager_name.errors and form_vendor.vendor_account_manager_name.data %}
                                {% for error in form_vendor.vendor_account_manager_name.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>

                    </div>

                    <div id="vendor_account_manager_phone" , class="col-md-2 row">
                        <div class=" ">
                            <div class="form-group " >
                                {{form_vendor.vendor_account_manager_phone.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_vendor.vendor_account_manager_phone(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form_vendor.vendor_account_manager_phone.errors and form_vendor.vendor_account_manager_phone.data %}
                                {% for error in form_vendor.vendor_account_manager_phone.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>

                    </div>
                    <div id="vendor_account_manager_email" , class="col-md-3 row ">
                        <div class="">
                            <div class="form-group " >
                                {{form_vendor.vendor_account_manager_email.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_vendor.vendor_account_manager_email(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form_vendor.vendor_account_manager_email.errors and form_vendor.vendor_account_manager_email.data %}
                                {% for error in form_vendor.vendor_account_manager_email.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>

                    </div>

                    <div id="delete_vendor" , class=" col-md-1 row ">
                        <div class="">
                            <div class="form-group " >
                                <br>
                                <button id="delete_form" type="button" name="delete_cisco" class="btn btn-outline-danger"
                                    onclick="deleteForm('#form_section_vendor_{{form_vendor.index.data}}')" value="test"> X</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

     
        <div class="row">
            <button id="btnvendor" type="button" class="btn btn-md btn-outline-primary justify-content-md-center  col-md-3 mt-4">
                Add a new Vendor</button>
        </div>
    </div>
    {%endif%}

</section>


<!--SECCION SOFTWARE-->
<input type="number" id="software_quantity" name="software_quantity" value="{{forms_software|length}}" hidden>
<section id="software" , name="seccion-prueba" , class="col-md-12">
    {% if forms_software %}
    <div class="row shadow-sm p-3 mb-5 bg-body rounded content-section border border-info" id="form_software">
        <legend class="text-center"><strong>SOFTWARE INFORMATION </strong></legend><br>

        <div id="all_software_forms" class="row">
            {% for form_software in forms_software %}
                <div class="col-md-12 row" id="form_section_software_{{form_software.index.data}}">
                    <hr>
                    <div id="software_type" , class="col-md-auto row">
                        <div class=" ">
                            <div class="custome-select ">
                                {{form_software.software_type.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_software.software_type(class="form-select form-control-md validated " ,
                                id='software_type_select')}}
                                {% if form_software.software_type.errors and form_software.software_type.data %}
                                {% for error in form_software.software_type.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                     <div id="subscription_id" , class="col-md-3 row">
                        <div class=" ">
                            <div class="form-group ">
                                {{form_software.subscription_id.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_software.subscription_id(class="form-control form-control-md validated " ,
                                id='subscription_id_field')}}
                                {% if form_software.subscription_id.errors and form_software.subscription_id.data %}
                                {% for error in form_software.subscription_id.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div id="duration_time" , class="col-md-3 row">
                        <div class=" ">
                            <div class="custome-select">
                                {{form_software.duration_time.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_software.duration_time(class="form-select form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form_software.duration_time.errors and form_software.duration_time.data %}
                                {% for error in form_software.duration_time.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                   
                    <div id="start_date" , class="col-md-3 row ">
                        <div class=" ">
                            <div class="form-group ">
                                {{form_software.start_date.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_software.start_date(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form_software.start_date.errors and form_software.start_date.data %}
                                {% for error in form_software.start_date.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div id="type_of_purchase" , class="col-md-3 row ">
                        <div class=" ">
                            <div class="custome-select ">
                                {{form_software.type_of_purchase.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}

                                {{form_software.type_of_purchase(class="form-select form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form_software.type_of_purchase.errors and form_software.type_of_purchase.data %}
                                {% for error in form_software.type_of_purchase.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                     <div id="customer_contact" , class="col-md-6 row ">
                        <div class=" ">
                            <div class="form-group ">
                                {{form_software.customer_contact.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form_software.customer_contact(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form_software.customer_contact.errors and form_software.customer_contact.data %}
                                {% for error in form_software.customer_contact.errors %}
                                <p id="error" class="text-danger"> {{error}}</p>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div id="delete_software" , class="col-md-auto  ">
                        <div class="">
                            <div class="form-group ">
                                <br>
                                <button id="delete_form" type="button" name="delete_software"
                                    class="btn btn-outline-danger mt-3" onclick="deleteForm('#form_section_software_{{form_software.index.data}}')">
                                    X</button>

                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="row">
            <button id="btnsoftware" type="button" class="btn btn-md btn-outline-primary justify-content-md-center  col-md-auto mt-4">
                Add a new Software</button>
        </div>
    </div>
    {% endif%}
</section>


<div class="col-md-12 shadow-sm p-3 mb-5 bg-body rounded content-section">
    <div class="row bg-primary p-2 text-dark bg-opacity-10">
        <legend class=""><i class="fs-6">Please add your Comments</i></legend>


        <div class="col-md-12 ">
            {{form.comments(class="form-control form-control-md validated " , id='validationcustome01')}}
            {% if form.comments.errors and form.comments.data %}
            {% for error in form.comments.errors %}
            <p id="error" class="text-danger"> {{error}}</p>
            {% endfor %}
            {% endif %}
        </div>
        <br>



    </div>
    <br>
    <div class="input-group col-md-2" for="validationcustome01">

        {{form.status(class="custom-select", id="inputGroupSelect04",
        for="validationCustom01")}}
        {% if form.status.errors and form.status.data %}
        {% for error in form.status.errors %}
        <p id="error" class="text-danger"> {{error}}</p>
        {% endfor %}
        {% endif %}
        <br>
        <br>


    </div>
</div>

<div class="row">
    <div class="form-group content-section">
        {{ form.submit(class="btn btn-md btn-primary ", id="submit") }}
    </div>
</div>

</form>

<script src="http://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
<script src="{{url_for ('static', filename='js/onload.js')}}"></script>

<script>

    let elementList = {
        "cisco": ["#cisco_deal_id", "#cisco_account_manager_name", "#cisco_account_manager_phone", "#cisco_account_manager_email", "#cisco_smart_account", "#cisco_virtual_account", "#delete_cisco"],
        "software": ["#software_type","#subscription_id", "#duration_time",  "#start_date", "#type_of_purchase", "#customer_contact","#delete_software" ],
        "vendor": ["#vendor_deal_id", "#vendor_name", "#vendor_account_manager_name", "#vendor_account_manager_phone", "#vendor_account_manager_email", "#delete_vendor"]
    }

    function changeAttribute(elements, formId, buttonId, sectionId, allFormsId) {

        var sectionLength = parseInt(document.querySelector(allForms).children.length)
        let isHidden = document.querySelector(`#${sectionId}_0`).hasAttribute("hidden")
        if (sectionLength == 1 && isHidden) {
            selectedForm = document.querySelector(allFormsId).children[0]
            for (element of elements) {
                field = selectedForm.querySelector(element).children[0].firstElementChild.children[1]
                field.removeAttribute("disabled")
            }
            document.querySelector(`#${sectionId}_0`).removeAttribute("hidden")
        }
        else if (sectionLength => 1 && !isHidden) {
            const hr = document.createElement("hr");
            hr.className = "mt-3";
            let form = document.querySelector(formId);
            let btn = document.querySelector(buttonId);
            let allForms = document.querySelector(allFormsId);
            const div = document.createElement("div")
            div.className = "col-md-12 row"
            form_section = `${sectionId}_${sectionLength}`
            div.id = form_section
            div.appendChild(hr)
            for (element of elements) {
                let field = document.querySelector(element).cloneNode(true);
                let error = field.querySelector("#error")
                if(error){
                    error.remove()
                }
                if (field) {
                    field.children[0].firstElementChild.children[1].name = element.replace("#", "") + sectionLength
                    field.children[0].firstElementChild.children[1].value = ""
                    if (field.id.includes("delete")) {
                        field.querySelector("#delete_form").setAttribute("onclick", `deleteForm('#${form_section}')`)
                    }
                    div.appendChild(field)
                }
                allForms.appendChild(div);
                form.appendChild(btn);
            }
        }

    }

    $(function () {
        $('#btnsoftware').on('click', function () {
            formId = "#form_software"
            buttonId = "#btnsoftware"
            sectionId = "form_section_software"
            allForms = "#all_software_forms"
            changeAttribute(elementList.software, formId, buttonId, sectionId, allForms)
            update_software_drop_down()
        });
    });

    $(function () {
        $('#btnvendor').on('click', function () {
            formId = "#form_vendor"
            buttonId = "#btnvendor"
            sectionId = "form_section_vendor"
            allForms = "#all_vendor_forms"
            changeAttribute(elementList.vendor, formId, buttonId, sectionId, allForms)

        });
    });
    $(function () {
        $('#btnciscovendor').on('click', function () {
            formId = "#form_cisco"
            buttonId = "#btnciscovendor"
            sectionId = "form_section_cisco"
            allForms = "#all_cisco_forms"
            changeAttribute(elementList.cisco, formId, buttonId, sectionId, allForms)

        });
    });

    // Function to delete Forms
    function deleteForm(elementId) {
        let form_name = elementId.split("_")[2]
        let form = document.querySelector(elementId)
        let allForms = document.querySelector(`#all_${form_name}_forms`)
        let sectionLength = allForms.children.length
        if (sectionLength == 1) {
            form.setAttribute("hidden", "")
            for (element of elementList[form_name]) {
                field = form.querySelector(element).children[0].firstElementChild.children[1]
                field.value = ""
                field.setAttribute("disabled", "")
            }
        }
        else {
            for (i = 0; i <= sectionLength - 1; i++) {
                form.remove()
                let form_section = `form_section_${form_name}_${i}`;
                let selectedForm = allForms.children[i]
                selectedForm.id = form_section
                for (element of elementList[form_name]) {
                    field = selectedForm.querySelector(element).children[0].firstElementChild.children[1]
                    field.name = element.replace("#", "") + i
                    if (field.id.includes("delete")) {
                        field.setAttribute("onclick", `deleteForm('#${form_section}')`)
                    }
                }
            }
        }
    }

</script>
<script>

    function update_software_drop_down() {
        let quantity = parseInt(document.querySelector("#all_software_forms").children.length)
        let dropDown = document.querySelectorAll("#software_type_select")
        let subscription_id = document.querySelectorAll("#subscription_id_field")
        for (let i = 0; i < quantity; i++) {
            dropDown[i].addEventListener("change", function (event) {
                if (dropDown[i].value != "SaaS") {
                    subscription_id[i].setAttribute("disabled", "")
                    subscription_id[i].value = ""
                }
                else {
                    subscription_id[i].removeAttribute("disabled")
                    subscription_id[i].setAttribute("required", "")
                }
            })
            if (dropDown[i].value != "SaaS") {
                subscription_id[i].setAttribute("disabled", "")
                subscription_id[i].value = ""
            }
        }
    }
    update_software_drop_down()

</script>

<script>
    // Script for the instant search bar for customer

    let customers = {{ customers | tojson }}
    const wrapper = document.querySelector(".wrapper"),
        selectBtn = wrapper.querySelector(".select-btn"),
        searchInp = wrapper.querySelector("input"),
        options = wrapper.querySelector(".options");
    let customer_name = document.querySelector("#customer_name");
    let customer_rut = document.querySelector("#customer_rut");
    let customer_id = document.querySelector("#customer_id");
    let customer_table = document.querySelector("#customer_table");
    let customer_data = document.querySelector("#customer_data");

    function update_customer_data() {
        let customer_name_row = document.querySelector("#customer_name_row");
        let customer_contact_row = document.querySelector("#customer_rut_row");

        customer_name_row.innerText = customer_name.value
        customer_rut_row.innerText = customer_rut.value
        if(customer_name.value && customer_rut.value){
            selectBtn.firstElementChild.innerText = `${customer_name.value} - ${customer_rut.value}`
        }   
    }
    update_customer_data();

    function addCustomer(selectedCustomer) {
        options.innerHTML = "";
        customers.forEach(customer => {
            let customerName = customer.customer_name + " - " + customer.customer_rut
            let isSelected = customerName == selectedCustomer ? "selected" : "";
            if (isSelected) {
                customer_name.setAttribute("value", customer.customer_name)
                customer_rut.setAttribute("value", customer.customer_rut)
                customer_id.setAttribute("value", customer.id)
                update_customer_data()
            }
            let li = `<li onclick="updateName(this)" class="${isSelected}" hidden>${customerName}</li>`;
            options.insertAdjacentHTML("beforeend", li);
        });
    }
    function updateName(selectedLi) {
        searchInp.value = "";
        addCustomer(selectedLi.innerText);
        wrapper.classList.remove("active");
        if(wrapper.firstElementChild.id.includes("error")){
            wrapper.firstElementChild.remove()
        }
        selectBtn.firstElementChild.innerText = selectedLi.innerText;

    }
    searchInp.addEventListener("keyup", () => {
        let arr = [];
        let searchWord = searchInp.value.toLowerCase();
        if(!searchWord){
            options.innerHTML = ""
        }
        else{  
            arr = customers.filter(data => {
                let customerName = data.customer_name + " - " + data.customer_rut
                return customerName.toLowerCase().startsWith(searchWord);
            }).map(data => {
                let customerName = data.customer_name + " - " + data.customer_rut
                let isSelected = data == selectBtn.firstElementChild.innerText ? "selected" : "";
                return `<li onclick="updateName(this)" class="${isSelected}">${customerName}</li>`;
            }).join("");
            options.innerHTML = arr ? arr : `<p style="margin-top: 10px;">Oops! Customer not found</p>`;
        }
        })


    selectBtn.addEventListener("click", () => {
        wrapper.classList.toggle("active")
    });

    // Function that validate on submit if a customer has been selected and also updates the quantity of the forms for the backend once submitted
    $(function () {
        $('#submit').on('click', function () {
            if(selectBtn.firstElementChild.innerText == "Select Customer"){
                let checklist = document.querySelector("#checklist");
                checklist.scrollIntoView()
                var error = `<p id="customer_select_error" class="text-danger text-center"> Please Select a Customer </p>`
                wrapper.insertAdjacentHTML("afterbegin", error)
            }
            else{
                cisco_quantity = document.querySelector("#all_cisco_forms").children.length
                vendor_quantity = document.querySelector("#all_vendor_forms").children.length
                software_quantity = document.querySelector("#all_software_forms").children.length
                document.querySelector("#cisco_quantity").value = cisco_quantity
                document.querySelector("#vendor_quantity").value = vendor_quantity
                document.querySelector("#software_quantity").value = software_quantity
                if(formHasData(elementList.cisco, document.querySelector("#form_section_cisco_0"))){
                    document.querySelector("#cisco_has_data").value = "true"
                }
                if(formHasData(elementList.vendor, document.querySelector("#form_section_vendor_0"))){
                    document.querySelector("#vendor_has_data").value = "true"
                }
                if(formHasData(elementList.software, document.querySelector("#form_section_software_0"))){
                    document.querySelector("#software_has_data").value = "true"
                }
            }
        });
    });

</script>

{%endblock content%}