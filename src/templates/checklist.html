{% extends 'layout.html'%}
{% block content%}


<!--seccion INFORMACION INICIAL-->

<div class="col-md-12">
    <form method="POST" action="" class="">

        {{ form.hidden_tag() }}
        {% if true %}
        <div class="row p-3 mb-5 bg-body rounded content-section border border-5 border-primary-subtle">
            <legend class="text-center"><strong class="display-6 colorh2">Purchase Order Processing Checklist -
                    Chile</strong></legend>
            <strong class="dislpay-6">Welcome {{current_user.name}}</strong>

            <div class="row">
                <div class="col-md-3">
                    {{form.sales_force_id.label(class="form-control-label mt-3 pt-0 mb-0 ",
                    for="validationCustom01")}}
                    {{form.sales_force_id(class="form-control form-control-md validated ")}}
                    {% if form.sales_force_id.errors and form.sales_force_id.data%}
                        {% for error in form.sales_force_id.errors %}
                            <p class="text-danger"> {{error}}</p>
                        {% endfor %}
                    {% endif %}

                </div>
                <div class="col-md-3">
                    {{form.purchase_order.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form.purchase_order(class="form-control form-control-md validated " , id='validationcustome01')}}
                    {% if form.purchase_order.errors and form.purchase_order.data%}
                        {% for error in form.purchase_order.errors %}
                            <p class="text-danger"> {{error}}</p>
                        {% endfor %}
                    {% endif %}

                </div>
                <div class="col-md-3">
                    {{form.quote_direct.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form.quote_direct(class="form-control form-control-md validated " , id='validationcustome01')}}
                    {% if form.quote_direct.errors and form.quote_direct.data%}
                        {% for error in form.quote_direct.errors %}
                            <p class="text-danger"> {{error}}</p>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="col-md-3">
                    {{form.pre_sales_name.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form.pre_sales_name(class="custom-select", id="inputGroupSelect04",
                    for="validationCustom01")}}
                    {% if form.pre_sales_name.errors and form.pre_sales_name.data%}
                        {% for error in form.pre_sales_name.errors %}
                            <p class="text-danger"> {{error}}</p>
                        {% endfor %}
                    {% endif %}
                </div>

            </div>


            <div class="row">


            </div>

        </div>


        <div class="col-md-12 ">
            <div class="row p-3 mb-5 bg-body rounded content-section border border-info">


                <legend class="text-center"><strong>CUSTOMER INFORMATION </strong></legend>
                <hr>
                <div>
                <div class="col-md-12 row">
                   
                    <div class="col-md-4 custome-select">
                        <div class="wrapper">
                            <div class="select-btn">
                                <span>Select Customer</span>
                                <i class="uil uil-angle-down"></i>
                            </div>
                            <div class="content">
                                <div class="search">
                                    <i class="uil uil-search"></i>
                                    <input spellcheck="false" type="text" placeholder="Search">
                                </div>
                                <ul class="options"></ul>
                            </div>
                        </div>


                        <table class="table mt-2 table-bordered" id="customer_table">
                            <tbody>
                                <tr>
                                    <th scope="col table-info">Customer Name</th>
                                    <td id="customer_name_row"></td>
                                </tr>
                                <tr>
                                    <th scope="col table-info">Customer RUT </th>
                                    <td id="customer_rut_row"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="col-md-8 row">
                        <legend class="text-center"><strong><i class="fs-6">Dispatch Customer Information</i></strong>
                        </legend>

                      

                            <div class="col-md-6">
                                {{form.customer_address.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.customer_address(class="form-control form-control-md mb-4 ml-2 validated " ,
                                id='validationcustome01')}}
                                {% if form.customer_address.errors and form.customer_address.data %}
                                    {% for error in form.customer_address.errors %}
                                        <p class="text-danger"> {{error}}</p>
                                    {% endfor %}
                                {% endif %}

                            </div>

                            <div class="col-md-6">
                                {{form.customer_contact_name.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.customer_contact_name(class="form-control form-control-md mb-4 ml-2 validated " ,
                                id='validationcustome01')}}
                                {% if form.customer_contact_name.errors and form.customer_contact_name.data %}
                                    {% for error in form.customer_contact_name.errors %}
                                        <p class="text-danger"> {{error}}</p>
                                    {% endfor %}
                                {% endif %}

                            </div>

                            <div class="col-md-6">
                                {{form.customer_contact_phone.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.customer_contact_phone(class="form-control form-control-md mb-4 ml-2 validated " ,
                                id='validationcustome01')}}
                                {% if form.customer_contact_phone.errors and form.customer_contact_phone.data %}
                                    {% for error in form.customer_contact_phone.errors %}
                                        <p class="text-danger"> {{error}}</p>
                                    {% endfor %}
                                {% endif %}

                            </div>

                            <div class="col-md-6">
                                {{form.customer_contact_email.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.customer_contact_email(class="form-control form-control-md mb-4 ml-2 validated " ,
                                id='validationcustome01')}}
                                {% if form.customer_contact_email.errors and form.customer_contact_email.data %}
                                    {% for error in form.customer_contact_email.errors %}
                                        <p class="text-danger"> {{error}}</p>
                                    {% endfor %}
                                {% endif %}

                            </div>

                            <div class="col-md-6">
                                {{form.dispatch_address.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.dispatch_address(class="form-control form-control-md mb-4 ml-2 validated " ,
                                id='validationcustome01')}}
                                {% if form.dispatch_address.errors and form.dispatch_address.data %}
                                    {% for error in form.dispatch_address.errors %}
                                        <p class="text-danger"> {{error}}</p>
                                    {% endfor %}
                                {% endif %}

                            </div>

                            <div class="col-md-6">

                                {{form.dispatch_receiver_name.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.dispatch_receiver_name(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form.dispatch_receiver_name.errors and form.dispatch_receiver_name.data%}
                                    {% for error in form.dispatch_receiver_name.errors %}
                                    <p class="text-danger"> {{error}}</p>
                                    {% endfor %}
                                {% endif %}


                            </div>
                            <div class="col-md-6">
                                {{form.dispatch_receiver_phone.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.dispatch_receiver_phone(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form.dispatch_receiver_phone.errors and form.dispatch_receiver_phone.data%}
                                    {% for error in form.dispatch_receiver_phone.errors %}
                                        <p class="text-danger"> {{error}}</p>
                                    {% endfor %}
                                {% endif %}

                            </div>
                            <div class="col-md-6">

                                {{form.dispatch_receiver_email.label(class="form-control-label mt-3 pt-0 mb-0",
                                for="validationCustom01")}}
                                {{form.dispatch_receiver_email(class="form-control form-control-md validated " ,
                                id='validationcustome01')}}
                                {% if form.dispatch_receiver_email.errors and form.dispatch_receiver_email.data %}
                                    {% for error in form.dispatch_receiver_email.errors %}
                                        <p class="text-danger"> {{error}}</p>
                                    {% endfor %}
                                {% endif %}

                            </div>

                        </div>

                  </div>
                </div>
            </div>
            {% endif %}
        </div>
        <!--SECCION CISCO-->

        {% if form.include_cisco.data==true%}
        <input type="number" id="cisco_quantity" name="cisco_quantity" value="{{forms_cisco|length}}" hidden>
        <section id="cisco_vendor" , name="seccion-prueba" , class="col-md-12">
            {% if forms_cisco %}
            <div class="row shadow-sm  mb-5 bg-body rounded content-section border border-info " id="form_cisco">
                {% for form_cisco in forms_cisco%}
                <legend class="text-center"><strong>CISCO VENDOR INFORMATION </strong></legend><br>
                
                <div id="all_cisco_forms" class="row">

                <div class="col-md-12 row" id="form_section_cisco_0" hidden>
                <hr>

                <div id="cisco_deal_id" , class="col-md-2 row">
                    <div class="">
                        <div class="form-group  border-1 needs-validation" novalidate>
                            {{form_cisco.cisco_deal_id.label(class="form-control-label", for="validationCustom01")}}
                            {{form_cisco.cisco_deal_id(class="form-control form-control-md validated " ,
                            id='validationcustome01', disabled=true)}}
                            <button id="btn_search_deal_id" , class="btn btn-md btn-outline-success mt-3">
                                Search</button>


                        </div>
                    </div>


                </div>

                <div id="cisco_account_manager_name" , class="col-md-auto row">
                    <div class="">
                        <div class="form-group  needs-validation" novalidate>
                            {{form_cisco.cisco_account_manager_name.label(class="form-control-label",
                            for="validationCustom01")}}
                            {{form_cisco.cisco_account_manager_name(class="form-control form-control-md validated " ,
                            id='validationcustome01', disabled=true)}}
                        </div>
                    </div>

                </div>
                <div id="cisco_account_manager_phone" , class="col-md-auto row ">
                    <div class="">
                        <div class="form-group  needs-validation" novalidate>
                            {{form_cisco.cisco_account_manager_phone.label(class="form-control-label",
                            for="validationCustom01")}}
                            {{form_cisco.cisco_account_manager_phone(class="form-control form-control-md validated " ,
                            id='validationcustome01', disabled=true)}}
                        </div>
                    </div>

                </div>

                <div id="cisco_account_manager_email" , class="col-md-auto row">
                    <div class="">
                        <div class="form-group  needs-validation" novalidate>
                            {{form_cisco.cisco_account_manager_email.label(class="form-control-label",
                            for="validationCustom01")}}
                            {{form_cisco.cisco_account_manager_email(class="form-control form-control-md validated " ,
                            id='validationcustome01', disabled=true)}}
                        </div>
                    </div>

                </div>
                <div id="cisco_smart_account" , class="col-md-auto row ">
                    <div class="">
                        <div class="form-group  needs-validation" novalidate>
                            {{form_cisco.cisco_smart_account.label(class="form-control-label",
                            for="validationCustom01")}}
                            {{form_cisco.cisco_smart_account(class="form-control form-control-md validated " ,
                            id='validationcustome01', disabled=true)}}
                        </div>
                    </div>

                </div>

                <div id="cisco_virtual_account" , class="col-md-auto row ">
                    <div class="">
                        <div class="form-group  needs-validation" novalidate>
                            {{form_cisco.cisco_virtual_account.label(class="form-control-label",
                            for="validationCustom01")}}
                            {{form_cisco.cisco_virtual_account(class="form-control form-control-md validated " ,
                            id='validationcustome01', disabled=true)}}


                        </div>
                    </div>
                </div>



                <div id="delete_cisco" , class=" col-md-1 row ">
                    <div class="">
                        <div class="form-group  needs-validation" novalidate>
                            <br>
                            <button id="delete_form" type="button" name="delete_cisco" class="btn btn-outline-danger" onclick="deleteForm('#form_section_cisco_0')"> X</button>


                        </div>
                    </div>
                </div>
                </div>
                </div>


                {% endfor %}
                <div class="row">
                    <button id="btnciscovendor" , class="btn btn-md btn-outline-primary  col-md-3 mt-4"> Add Cisco Vendor </button>
                </div>
            </div>
            {% endif %}

            {% endif %}
            {{ form.include_cisco(hidden=True) }}
            {{ form.include_vendor(hidden=True) }}
            {{ form.include_software(hidden=True) }}
            {{ customer.customer_name(hidden=True, id="customer_name") }}
            {{ customer.customer_rut(hidden=True, id="customer_rut") }}
            {{ form.customer_id(hidden=True, id="customer_id") }}

</div>


</div>
</div>

</section>


<!--SECCION VENDOR-->
{% if form.include_vendor.data==true%}
<input type="number" id="vendor_quantity" name="vendor_quantity" value="{{forms_vendor|length}}" hidden>
<section id="vendor" , name="seccion-prueba" , class="col-md-12">
    {% if forms_vendor %}
    <div class="row shadow-sm p-3 mb-5 bg-body rounded content-section border border-info" id="form_vendor">
        {% for form_vendor in forms_vendor%}
        <legend class="text-center"><strong>VENDOR INFORMATION </strong></legend><br>
        
        <div id="all_vendor_forms" class="row">

        <div class="col-md-12 row" id="form_section_vendor_0" hidden disable>
        <hr>
        <div id="vendor_name" , class="col-md-2 row">
            <div class="">
                <div class="form-group  needs-validation" novalidate>
                    {{form_vendor.vendor_name.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_vendor.vendor_name(class="form-control form-control-md validated " ,
                    id='validationcustome01', disabled=true)}}
                </div>
            </div>

        </div>
        <div id="vendor_deal_id" , class="col-md-2 row">
            <div class="">
                <div class="form-group  needs-validation" novalidate>
                    {{form_vendor.vendor_deal_id.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_vendor.vendor_deal_id(class="form-control form-control-md validated " ,
                    id='validationcustome01', disabled=true)}}
                </div>
            </div>

        </div>


        <div id="vendor_account_manager_name" , class="col-md-2 row ">
            <div class=" ">
                <div class="form-group  needs-validation" novalidate>
                    {{form_vendor.vendor_account_manager_name.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_vendor.vendor_account_manager_name(class="form-control form-control-md validated " ,
                    id='validationcustome01', disabled=true)}}
                </div>
            </div>

        </div>

        <div id="vendor_account_manager_phone" , class="col-md-2 row">
            <div class=" ">
                <div class="form-group  needs-validation" novalidate>
                    {{form_vendor.vendor_account_manager_phone.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_vendor.vendor_account_manager_phone(class="form-control form-control-md validated " ,
                    id='validationcustome01', disabled=true)}}
                </div>
            </div>

        </div>
        <div id="vendor_account_manager_email" , class="col-md-3 row ">
            <div class="">
                <div class="form-group  needs-validation" novalidate>
                    {{form_vendor.vendor_account_manager_email.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_vendor.vendor_account_manager_email(class="form-control form-control-md validated " ,
                    id='validationcustome01', disabled=true)}}
                </div>
            </div>

        </div>

        <div id="delete_vendor" , class=" col-md-1 row ">
            <div class="">
                <div class="form-group  needs-validation" novalidate>
                    <br>
                    <button id="delete_form" type="button" name="delete_cisco" class="btn btn-outline-danger" onclick="deleteForm('#form_section_vendor_0')"> X</button>
                </div>
            </div>
        </div>
        </div>
    </div>

        {% endfor %}
        <div class="row">
            <button id="btnvendor" class="btn btn-md btn-outline-primary justify-content-md-center  col-md-3 mt-4">
                Add a new Vendor</button>
        </div>
    </div>
    {%endif%}
    {%endif%}

</section>


<!--SECCION SOFTWARE-->
{% if form.include_software.data==true%}
<input type="number" id="software_quantity" name="software_quantity" value="{{forms_software|length}}" hidden>
<section id="software" , name="seccion-prueba" , class="col-md-12">
    {% if forms_software %}
    <div class="row shadow-sm p-3 mb-5 bg-body rounded content-section border border-info" id="form_software">
        {% for form_software in forms_software %}
        <legend class="text-center"><strong>SOFTWARE INFORMATION </strong></legend><br>
        
        <div id="all_software_forms" class="row">

        <div class="col-md-12 row" id="form_section_software_0" hidden disable>
        <hr>
        <div id="software_type" , class="col-md-auto row">
            <div class=" ">
                <div class="custome-select  needs-validation" novalidate>
                    {{form_software.software_type.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_software.software_type(class="form-select form-control-md validated " ,
                    id='software_type_select', disabled=true)}}
                </div>
            </div>
        </div>
        <div id="duration_time" , class="col-md-auto row">
            <div class=" ">
                <div class="custome-select needs-validation" novalidate>
                    {{form_software.duration_time.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_software.duration_time(class="form-select form-control-md validated " ,
                    id='validationcustome01', disabled=true)}}
                </div>
            </div>
        </div>
        <div id="customer_contact" , class="col-md-auto row ">
            <div class=" ">
                <div class="form-group  needs-validation" novalidate>
                    {{form_software.customer_contact.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_software.customer_contact(class="form-control form-control-md validated " ,
                    id='validationcustome01', disabled=true)}}
                </div>
            </div>
        </div>

        <div id="subscription_id" , class="col-md-auto row">
            <div class=" ">
                <div class="form-group  needs-validation" novalidate>
                    {{form_software.subscription_id.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_software.subscription_id(class="form-control form-control-md validated " ,
                    id='subscription_id_field', disabled=true)}}
                </div>
            </div>
        </div>
        <div id="start_date" , class="col-md-auto row ">
            <div class=" ">
                <div class="form-group  needs-validation" novalidate>
                    {{form_software.start_date.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}
                    {{form_software.start_date(class="form-control form-control-md validated " ,
                    id='validationcustome01', disabled=true)}}
                </div>
            </div>
        </div>
        <div id="type_of_purchase" , class="col-md-auto row ">
            <div class=" ">
                <div class="custome-select  needs-validation" novalidate>
                    {{form_software.type_of_purchase.label(class="form-control-label mt-3 pt-0 mb-0",
                    for="validationCustom01")}}

                    {{form_software.type_of_purchase(class="form-select form-control-md validated " ,
                    id='validationcustome01', disabled=true)}}
                </div>
            </div>
        </div>
        <div id="delete_software" , class="col-md-auto  ">
            <div class="">
                <div class="form-group  needs-validation" novalidate>
                    <br>
                    <button id="delete_form" type="button" name="delete_software" class="btn btn-outline-danger mt-3" onclick="deleteForm('#form_section_software_0')"> X</button>

                </div>
            </div>
        </div>
        </div>
    </div>

        {% endfor %}
        <div class="row">
            <button id="btnsoftware" class="btn btn-md btn-outline-primary justify-content-md-center  col-md-auto mt-4">
                Add a new Software</button>
        </div>
    </div>
    {% endif%}
    {% endif%}
</section>


<div class="col-md-12 shadow-sm p-3 mb-5 bg-body rounded content-section">
    <div class="row bg-primary p-2 text-dark bg-opacity-10">
        <legend class=""><i class="fs-6">Please add your Comments</i></legend>


        <div class="col-md-12 ">
            {{form.comments(class="form-control form-control-md validated " , id='validationcustome01')}}
            {% if form.comments.errors and form.comments.data %}
                {% for error in form.comments.errors %}
                    <p class="text-danger"> {{error}}</p>
                {% endfor %}
            {% endif %}
        </div>
        <br>



    </div>
    <br>
    <div class="input-group col-md-2" for="validationcustome01">

            {{status.assignment(class="custom-select", id="inputGroupSelect04",
            for="validationCustom01")}}
            {% if status.assignment.errors %}
                {% for error in status.assignment.errors %}
                    <p class="text-danger"> {{error}}</p>
                {% endfor %}
            {% endif %}
        <br>
        <br>


    </div>
</div>

<div class="row">





    <div class="form-group content-section">
        {{ form.submit(class="btn btn-md btn-primary ", id="submit") }}
    </div>



    </fieldset>
</div>

</form>

<script src="http://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>



<script>

    let elementList = {"cisco": ["#cisco_deal_id", "#cisco_account_manager_name", "#cisco_account_manager_phone", "#cisco_account_manager_email", "#cisco_smart_account", "#cisco_virtual_account", "#delete_cisco"],
    "software":["#software_type", "#duration_time", "#customer_contact", "#subscription_id", "#start_date", "#type_of_purchase", "#delete_software"],
    "vendor":["#vendor_name", "#vendor_deal_id", "#vendor_account_manager_name", "#vendor_account_manager_phone", "#vendor_account_manager_email", "#delete_vendor"]}

    function changeAttribute(elements, formId, buttonId, sectionId, allFormsId) {
        
        var sectionLength = parseInt(document.querySelector(allForms).children.length)
        let isHidden = document.querySelector(`#${sectionId}_0`).hasAttribute("hidden")
        if(sectionLength == 1 && isHidden){
            selectedForm = document.querySelector(allFormsId).children[0]
            for (element of elements) {
                field = selectedForm.querySelector(element).children[0].firstElementChild.children[1]
                field.removeAttribute("disabled")
            }
            document.querySelector(`#${sectionId}_0`).removeAttribute("hidden")
        }
        else{
            const hr = document.createElement("hr");
            hr.className = "mt-3";
            let form = document.querySelector(formId);
            let btn = document.querySelector(buttonId);
            let allForms = document.querySelector(allFormsId);
            const div = document.createElement("div")
            div.className = "col-md-12 row"
            form_section = `${sectionId}_${sectionLength}`
            div.id = form_section
            div.appendChild(hr)
            for (element of elements) {
                let field = document.querySelector(element).cloneNode(true);
                if (field) {
                    field.children[0].firstElementChild.children[1].name = element.replace("#", "") + sectionLength
                    field.children[0].firstElementChild.children[1].value = ""
                    if(field.id.includes("delete")){
                        console.log(field.querySelector("#delete_form"))
                        field.querySelector("#delete_form").setAttribute("onclick", `deleteForm('#${form_section}')`)
                    }
                    div.appendChild(field)
                }
                allForms.appendChild(div);
                form.appendChild(btn);
    
    
            }
        }

    }
    
    $(function () {
        $('#btnsoftware').on('click', function () {      
            formId = "#form_software"
            buttonId = "#btnsoftware"
            sectionId = "form_section_software"
            allForms = "#all_software_forms"
            changeAttribute(elementList.software, formId, buttonId, sectionId, allForms)
            update_software_drop_down()
        });
    });

    $(function () {
        $('#btnvendor').on('click', function () {
            formId = "#form_vendor"
            buttonId = "#btnvendor"
            sectionId = "form_section_vendor"
            allForms = "#all_vendor_forms"
            changeAttribute(elementList.vendor, formId, buttonId, sectionId, allForms)

        });
    });
    $(function () {
        $('#btnciscovendor').on('click', function () {
            formId = "#form_cisco"
            buttonId = "#btnciscovendor"
            sectionId = "form_section_cisco"
            allForms = "#all_cisco_forms"
            changeAttribute(elementList.cisco, formId, buttonId, sectionId, allForms)

        });
    });
    $(function () {
        $('#submit').on('click', function () {
            cisco_quantity = document.querySelector("#all_cisco_forms").children.length
            vendor_quantity = document.querySelector("#all_vendor_forms").children.length
            software_quantity = document.querySelector("#all_software_forms").children.length
            document.querySelector("#cisco_quantity").value = cisco_quantity
            document.querySelector("#vendor_quantity").value = vendor_quantity
            document.querySelector("#software_quantity").value = software_quantity
        });
    });

    // Function to delete Forms
    function deleteForm(elementId){
        let form_name = elementId.split("_")[2]
        let form = document.querySelector(elementId)
        let allForms = document.querySelector(`#all_${form_name}_forms`)
        let sectionLength = allForms.children.length
        if(sectionLength == 1){
            form.setAttribute("hidden", "")
            for(element of elementList[form_name]){
                field = form.querySelector(element).children[0].firstElementChild.children[1]
                field.setAttribute("disabled", "")
            }
        }
        else{
            for(i=0; i<=sectionLength-1; i++){
                form.remove()
                let form_section = `form_section_${form_name}_${i}`;
                let selectedForm = allForms.children[i]
                selectedForm.id = form_section
                for(element of elementList[form_name]){
                    field = selectedForm.querySelector(element).children[0].firstElementChild.children[1]
                    field.name = element.replace("#", "") + i
                    if(field.id.includes("delete")){
                        field.setAttribute("onclick", `deleteForm('#${form_section}')`)
                    }
                }
            }
        }
    }

</script>
<script>
    {% if form.include_software.data == true %}

    function update_software_drop_down() {
        let quantity = parseInt(document.querySelector("#all_software_forms").children.length)
        let dropDown = document.querySelectorAll("#software_type_select")
        let subscription_id = document.querySelectorAll("#subscription_id_field")
        for (let i = 0; i < quantity; i++) {
            dropDown[i].addEventListener("change", function (event) {
                if (dropDown[i].value != "SaaS") {
                    subscription_id[i].setAttribute("disabled", "")
                }
                else {
                    subscription_id[i].removeAttribute("disabled")
                }
            })
            if (dropDown[i].value != "SaaS") {
                subscription_id[i].setAttribute("disabled", "")
            }
        }
    }
    update_software_drop_down()

    {% endif %}
</script>

<script>
    // Script for the Autocomplete search bar for customer

    let customers = {{ customers | tojson }}
    const wrapper = document.querySelector(".wrapper"),
        selectBtn = wrapper.querySelector(".select-btn"),
        searchInp = wrapper.querySelector("input"),
        options = wrapper.querySelector(".options");
    let customer_name = document.querySelector("#customer_name")
    let customer_rut = document.querySelector("#customer_rut")
    let customer_id = document.querySelector("#customer_id")
    let customer_table = document.querySelector("#customer_table")
    let customer_data = document.querySelector("#customer_data")

    function update_customer_data() {
        let customer_name_row = document.querySelector("#customer_name_row")
        let customer_contact_row = document.querySelector("#customer_rut_row")

        customer_name_row.innerText = customer_name.value
        customer_rut_row.innerText = customer_rut.value
    }
    update_customer_data()

    function addCustomer(selectedCustomer) {
        options.innerHTML = "";
        customers.forEach(customer => {
            customerName = customer.customer_name + " - " + customer.customer_rut
            let isSelected = customerName == selectedCustomer ? "selected" : "";
            if (isSelected) {
                customer_name.setAttribute("value", customer.customer_name)
                customer_rut.setAttribute("value", customer.customer_rut)
                customer_id.setAttribute("value", customer.id)
                update_customer_data()
            }
            let li = `<li onclick="updateName(this)" class="${isSelected}">${customerName}</li>`;
            options.insertAdjacentHTML("beforeend", li);
        });
    }
    addCustomer();
    function updateName(selectedLi) {
        searchInp.value = "";
        addCustomer(selectedLi.innerText);
        wrapper.classList.remove("active");
        selectBtn.firstElementChild.innerText = selectedLi.innerText;

    }
    searchInp.addEventListener("keyup", () => {
        let arr = [];
        let searchWord = searchInp.value.toLowerCase();
        arr = customers.filter(data => {
            customerName = data.customer_name + " - " + data.customer_rut
            return customerName.toLowerCase().startsWith(searchWord);
        }).map(data => {
            customerName = data.customer_name + " - " + data.customer_rut
            let isSelected = data == selectBtn.firstElementChild.innerText ? "selected" : "";
            return `<li onclick="updateName(this)" class="${isSelected}">${customerName}</li>`;
        }).join("");
        options.innerHTML = arr ? arr : `<p style="margin-top: 10px;">Oops! Customer not found</p>`;
    });
    selectBtn.addEventListener("click", () => {
        wrapper.classList.toggle("active")
    });
</script>

{%endblock content%}